<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body{
            background-color: pink;
        }
        canvas {
            background-color: #99ff99;
        }
    </style>
    <script src="test.js"></script>
</head>
<body>

<center>
    <canvas id="myCanvas" width="600px" height="600px" style="border: 1px solid black"></canvas>
</center>

<script>
    let name1=prompt("Nhập tên của bạn =  ");
    alert("Hello"+" "+ name1);
    alert("Are you ready ?")
    let canvas = document.getElementById('myCanvas');
    let pen = canvas.getContext('2d');
    let interval = setInterval(draw, 10);
    let pad = {
        width: 150,
        height: 20,
        x: 0,
        y: canvas.height - 20,
        speed: 45,
    }
    let Bricks = {
        brickX: 25,
        brickY: 25,
        range: 25,
        width: 90,
        height: 25,
        totalRow: 3,
        totalCol: 5,

    }
    let x = 300;
    let y = 300;
    let circle = new Circle(x, y);
    circle.drawCircle(pen);
    let isGameOver = false;
    let isGameWin=false;
    let Score=0;
    let maxScores = Bricks.totalCol*Bricks.totalRow;

    //==================================
     function drawScore(){
         pen.font="16px Arial";
         pen.fillStyle = "#0095DD";
         pen.fillText("Score: "+Score, 8, 20);
     }
    //================================
    //===============================================
    let BricksList = [];
    for (let i = 0; i < Bricks.totalRow; i++) {
        for (let j = 0; j < Bricks.totalCol; j++) {
            BricksList.push({
                x: Bricks.brickX + j * (Bricks.width + Bricks.range),
                y: Bricks.brickY + i * (Bricks.height + Bricks.range),
                checkBreak: false
            });
        }
    }

    //==================================
    let dx = 5;
    let  dy = 2;

    function checkCrash() {
        BricksList.forEach(function (b) {
            if (!b.checkBreak) {
                if (circle.x >= b.x && circle.x <= b.x + Bricks.width && circle.y + 15 >= b.y && circle.y-15<=b.y+Bricks.height){
                    dy=-dy;
                    b.checkBreak=true;
                    Score+=1;
                    if(Score>=maxScores){
                        isGameOver=true;
                        isGameWin=true;
                        document.location.reload();
                        clearInterval(interval);
                    }
                }
                    }
        })
    }

    // =============================================
    function moveCircle() {
        if (!isGameOver) {
            pen.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);
            if (circle.x < 15 || circle.x > canvas.clientWidth - 15) {
                dx = -dx;
            }
            if (circle.y < 15) {
                dy = -dy;
            }
            circle.x += dx;
            circle.y += dy;
            circle.drawCircle(pen);
            draw()
            bouncedBack()
            drawBricks()
            checkCrash()
            drawScore()
            if (circle.y > canvas.clientHeight - 15) {
                isGameOver = true;
            }
        } else {
            checkGameOver()
            document.location.reload();
            clearInterval(interval);
        }
    }

    setInterval(moveCircle, 10);
    //=================================================
    function checkGameOver() {
        if(isGameWin){
            alert("You Win with 15 Score");
        }else alert('you lose with '+ " "+ Score + " Score");

    }
    //======================================================
    function bouncedBack() {
        if (circle.x + 15 >= pad.x && circle.x + 15 <= pad.x + pad.width && circle.y + 15 >= canvas.height - pad.height) {
            dy = -dy;
        }
    }


    //==========================================================
    function draw() {
        let pen = canvas.getContext('2d');
        pen.beginPath();
        pen.rect(pad.x, pad.y, pad.width, pad.height);
        pen.fillStyle = "red";
        pen.fill();
        pen.closePath();
    }

    draw();

    //==============================================
    function drawBricks() {
        BricksList.forEach(function (b) {
            if(!b.checkBreak) {
                pen.beginPath();
                pen.rect(b.x, b.y, Bricks.width, Bricks.height);
                pen.fill();
                pen.closePath();
            }
        })
    }

    //==========================================
    document.addEventListener('keydown', function (event) {
        if (event.keyCode == 37 && pad.x > 0) {
            pad.x -= pad.speed;
        } else if (event.keyCode == 39 && pad.x < canvas.clientWidth - 150) {
            pad.x += pad.speed;
        }
    })

</script>
</body>
</html>